Pv = 1
Pb = 2
grid<-seq(-1,1,length.out=p)
M<-matrix(grid,ncol=q,nrow=p)
rate<-trunc(p/(q*2))
for(i in 2:q){
M[,i]<-grid[c((i*rate):p,1:(i*rate-1))]
}
Z <- rmvnorm(n,numeric(q),diag(q))
Psi <- diag(c(rep(.5,p)),p)
V <- matrix(ncol = Pv, nrow = n, runif(n*Pv,0,3))
Theta = matrix(ncol=Pv,c(rep(-2,round(p/2)),rep(2,p-round(p/2))))
batch = round(runif(n,0,1),0)
B = matrix(ncol=Pb, c(batch,ifelse(batch==1,0,1)))
Beta = matrix(ncol=Pb, c(rep(2,p),rep(0,p)))
Tau_inv = cbind(diag(Psi),diag(Psi)*1.5)
Er = matrix(ncol=p, nrow=n)
for (i in 1:n){
if(i%%10==0){print(i)}
Er[i,] = mvrnorm(1, rep(0,p), diag(c(Tau_inv %*% B[i,]),p), tol = 1e-6, empirical = FALSE, EISPACK = FALSE)
}
X <- Z%*%t(M) + V%*%t(Theta) + B%*%t(Beta) + Er
##Estimation
#MOM
MOM_10=BFR.BE.EM.CV(x=X,v=V,b=B,q = 10)
MOM_100=BFR.BE.EM.CV(x=X,v=V,b=B,q = 100)
#Normal
Normal_10=BFR.BE.EM.CV(x=X,v=V,b=B,q = 10, prior="Normal")
Normal_100=BFR.BE.EM.CV(x=X,v=V,b=B,q = 100, prior="Normal")
#Flat
Flat_10=BFR.BE.EM.CV(x=X,v=V,b=B,q = 10, prior="Flat")
Flat_100=BFR.BE.EM.CV(x=X,v=V,b=B,q = 100, prior="Flat")
##Comparisons
#LASSO
rho.aux=as.matrix(seq(0.2,0.75,length.out=6))
rho.aux.1=as.matrix(seq(0.0075,0.75,length.out=10))
fit_lasso_10<- fanc(X,factors=10,rho=rho.aux.1,gamma=Inf)
fit_lasso_100<- fanc(X,factors=100,rho=rho.aux,gamma=Inf)
lasso_10<-select(fit_lasso_10, criterion="BIC", gamma=Inf)
lasso_100<-select(fit_lasso_100, criterion="BIC", gamma=Inf)
lasso_10.Ez=E.Z(X,as.matrix(lasso_10$loadings),lasso_10$uniquenesses,diag(10))$z
lasso_100.Ez=E.Z(X,as.matrix(lasso_100$loadings),lasso_100$uniquenesses,diag(100))$z
#COMBAT
mod_COMBAT <- model.matrix(~V, data=data.frame(X))
COMBAT <- ComBat(dat=t(X), batch=B[,1], mod=mod_COMBAT)
cov_COMBAT = cov(COMBAT)
COMBAT_10 = fa.em(t(COMBAT),10,tol=0.001, maxiter = 100)
COMBAT_100 = fa.em(t(COMBAT),100,tol=0.001, maxiter = 100)
#####Table####
q.hat.2=data.frame(Flat_10=10,
Normal_10=sum(apply(Normal_10$gamma>0.5,2,sum)!=0),
MOM_10=sum(apply(MOM_10$gamma>0.5,2,sum)!=0),
COMBAT_10=ncol(COMBAT_10$Gamma),
#FastBFA_10=sum(apply(Laplace_10_Vl20$P_star>0.5,2,sum)!=0),
Lasso_10=sum(apply(lasso_10$loadings,2,sum)!=0),
Flat_100=100,
Normal_100=sum(apply(Normal_100$gamma>0.5,2,sum)!=0),
MOM_100=sum(apply(MOM_100$gamma>0.5,2,sum)!=0),
COMBAT_100=ncol(COMBAT_100$Gamma),
#FastBFA_100=sum(apply(resultLaplace_100_Vl20$P_star>0.5,2,sum)!=0),
Lasso_100=sum(apply(lasso_100$loadings,2,sum)!=0))
m.hat.2=data.frame(Flat_10=250*10,
Normal_10=sum(Normal_10$gamma>0.5),
MOM_10=sum(MOM_10$gamma>0.5),
COMBAT_10= length(COMBAT_10$Gamma),
#FastBFA_10=sum(Laplace_10_Vl20$P_star),
Lasso_10=sum(apply(lasso_10$loadings!=0,2,sum)),
Flat_100=250*100,
Normal_100=sum(Normal_100$gamma>0.5),
MOM_100=sum(MOM_100$gamma>0.5),
COMBAT_100= length(COMBAT_100$Gamma),
#FastBFA_100=sum(Laplace_100_Vl20$P_star),
Lasso_100=sum(apply(lasso_100$loadings!=0,2,sum)))
FN.ZM=data.frame(Flat_10=FNorm(Flat_10$Ez,Flat_10$M,Z,M),
Normal_10=FNorm(Normal_10$Ez,Normal_10$Mpost,Z,M),
MOM_10=FNorm(MOM_10$Ez,MOM_10$Mpost,Z,M),
COMBAT_10=FNorm(COMBAT_10$Z,COMBAT_10$Gamma,Z,M),
#FastBFA_10=FNorm(Laplace_10_Vl20$Omega,Laplace_10_Vl20$B,Z,M),
Lasso_10=FNorm(lasso_10.Ez,as.matrix(lasso_10$loadings),Z,M),
Flat_100=FNorm(Flat_100$Ez,Flat_100$M,Z,M),
Normal_100=FNorm(Normal_100$Ez,Normal_100$Mpost,Z,M),
MOM_100=FNorm(MOM_100$Ez,MOM_100$Mpost,Z,M),
COMBAT_100=FNorm(COMBAT_100$Z,COMBAT_100$Gamma,Z,M),
#FastBFA_100=FNorm(Laplace_100_Vl20$Omega,Laplace_100_Vl20$B,Z,M),
Lasso_100=FNorm(lasso_100.Ez,as.matrix(lasso_100$loadings),Z,M))
FN.x=data.frame(Flat_10=FNormXhat(Flat_10,Z,V,B,Theta,Beta,M,Flat_10$columns),
Normal_10=FNormXhat(Normal_10,Z,V,B,Theta,Beta,M,Normal_10$columns),
MOM_10=FNormXhat(MOM_10,Z,V,B,Theta,Beta,M,MOM_10$columns),
COMBAT_10=FNormXhatC(COMBAT_10$Z,COMBAT_10$Gamma,t(COMBAT)),
#FastBFA_10=FNormXhatL(Laplace_10_Vl20$Omega,Laplace_10_Vl20$B,Z,V,B,Theta,Beta,M),
Lasso_10=FNormXhatL(lasso_10.Ez,as.matrix(lasso_10$loadings),Z,V,B,Theta,Beta,M),
Flat_100=FNormXhat(Flat_100,Z,V,B,Theta,Beta,M,Flat_100$columns),
Normal_100=FNormXhat(Normal_100,Z,V,B,Theta,Beta,M,Normal_100$columns),
MOM_100=FNormXhat(MOM_100,Z,V,B,Theta,Beta,M,MOM_100$columns),
COMBAT_100=FNormXhatC(COMBAT_100$Z,COMBAT_100$Gamma,t(COMBAT)),
#FastBFA_100=FNormXhatL(Laplace_100_Vl20$Omega,Laplace_100_Vl20$B,Z,V,B,Theta,Beta,M),
Lasso_100=FNormXhatL(lasso_100.Ez,as.matrix(lasso_100$loadings),Z,V,B,Theta,Beta,M))
it=data.frame(Flat_10=Flat_10$iterations,
Normal_10=Normal_10$iterations,
MOM_10=MOM_10$iterations,
COMBAT_10=COMBAT_10$niter,
#FastBFA_10=(Laplace_10_Vl5$niter+Laplace_10_Vl10$niter+Laplace_10_Vl10$niter),
Lasso_10=0,
Flat_100=Flat_100$iterations,
Normal_100=Normal_100$iterations,
MOM_100=MOM_100$iterations,
COMBAT_100=COMBAT_100$niter,
#FastBFA_100=(Laplace_100_Vl5$niter+Laplace_100_Vl10$niter+Laplace_100_Vl10$niter),
Lasso_100=0)
tableFN=rbind.data.frame(q_hat=q.hat.2,Mhat=m.hat.2,FN_X=FN.x,FN_ZM2=FN.ZM,it=it)
t(tableFN)
####FIX###
####n=100 p=1,000####
####n=100 p=1,000####
t1.1000.F<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Examples/Paper1806/Table1809FixMn100p1000q10NBv2Dataset01")
t1.1000.F
####FIX###
####n=200 p=250####
t1.250F<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Examples/Paper1806/Table1809FixMn100p250q10BEDataset01")
t1.250F
t(tableFN)
##Heatmaps
##M
#Truth
plot.heat(M,Xlab="p",Ylab="q")
#Flat
plot.heat(Flat_100$M)
#Normal
plot.heat(Normal_100$Mpost)
#MOM
plot.heat(MOM_100$Mpost)
##Covariance
#Truth
plot.heat.cov(M,Psi,Xlab="p",Ylab="p")
#Flat
plot.heat.cov(Flat_100$M,diag(Flat_100$sigma[,1]))
#Normal
plot.heat.cov(Normal_100$M,diag(Normal_100$sigma[,1]))
#MOM
plot.heat.cov(MOM_100$M,diag(MOM_100$sigma[,1]))
##Gamma
plot.heat(Normal_100$gamma)
plot.heat(MOM_100$gamma)
library(BFR.BE) #My code
library(fanc) #LASSO
#####Running simulations####
set.seed(123)
n<-100
p<-1000
q<-10
grid<-seq(-1,1,length.out=p)
M<-matrix(grid,ncol=q,nrow=p)
rate<-trunc(p/(q*2))
for(i in 2:q){
M[,i]<-grid[c((i*rate):p,1:(i*rate-1))]
}
E <- rmvnorm(n,numeric(p),diag(p))
Z <- rmvnorm(n,numeric(q),diag(q))
X <- Z%*%t(M) + E
Sigma<-M%*%t(M)+diag(p)
##Estimation
#MOM
MOM_10=BFR.BE.EM.CV(x=X,q = 10,varianceBE=FALSE)
MOM_100=BFR.BE.EM.CV(x=X,q = 100,varianceBE=FALSE)
#Normal
Normal_10=BFR.BE.EM.CV(x=X,q = 10, prior="Normal",varianceBE=FALSE)
Normal_100=BFR.BE.EM.CV(x=X,q = 100, prior="Normal",varianceBE=FALSE)
#Flat
Flat_10=BFR.BE.EM.CV(x=X,q = 10, prior="Flat",varianceBE=FALSE)
Flat_100=BFR.BE.EM.CV(x=X,q = 100, prior="Flat",varianceBE=FALSE)
##Comparisons
#LASSO
rho.aux=as.matrix(seq(0.3,0.60,length.out=6))
rho.aux.1=as.matrix(seq(0.3,0.60,length.out=6))
fit_lasso_10<- fanc(X,factors=10,rho=rho.aux.1,gamma=Inf)
fit_lasso_100<- fanc(X,factors=100,rho=rho.aux,gamma=Inf)
lasso_10<-select(fit_lasso_10, criterion="BIC", gamma=Inf)
lasso_100<-select(fit_lasso_100, criterion="BIC", gamma=Inf)
lasso_10.Ez=E.Z(X,as.matrix(lasso_10$loadings),lasso_10$uniquenesses,diag(10))$z
lasso_100.Ez=E.Z(X,as.matrix(lasso_100$loadings),lasso_100$uniquenesses,diag(100))$z
#####Table####
q.hat.2=data.frame(Flat_10=10,
Normal_10=sum(apply(Normal_10$gamma>0.5,2,sum)!=0),
MOM_10=sum(apply(MOM_10$gamma>0.5,2,sum)!=0),
#FastBFA_10=sum(apply(Laplace_10_Vl20$P_star>0.5,2,sum)!=0),
Lasso_10=sum(apply(lasso_10$loadings,2,sum)!=0),
Flat_100=100,
Normal_100=sum(apply(Normal_100$gamma>0.5,2,sum)!=0),
MOM_100=sum(apply(MOM_100$gamma>0.5,2,sum)!=0),
#FastBFA_100=sum(apply(Laplace_100_Vl20$P_star>0.5,2,sum)!=0),
Lasso_100=sum(apply(lasso_100$loadings,2,sum)!=0))
m.hat.2=data.frame(Flat_10=1000*10,
Normal_10=sum(Normal_10$gamma>0.5),
MOM_10=sum(MOM_10$gamma>0.5),
#FastBFA_10=sum(Laplace_100_Vl20$P_star),
Lasso_10=sum(apply(lasso_10$loadings!=0,2,sum)),
Flat_100=1000*100,
Normal_100=sum(Normal_100$gamma>0.5),
MOM_100=sum(MOM_100$gamma>0.5),
#FastBFA_100=sum(Laplace_100_Vl20$P_star),
Lasso_100=sum(apply(lasso_100$loadings!=0,2,sum)))
FN.ZM=data.frame(Flat_10=FNorm(Flat_10$Ez,Flat_10$M,Z,M),
Normal_10=FNorm(Normal_10$Ez,Normal_10$Mpost,Z,M),
MOM_10=FNorm(MOM_10$Ez,MOM_10$Mpost,Z,M),
#FastBFA_10=FNorm(Laplace_10_Vl20$Omega,Laplace_10_Vl20$B,Z,M),
Lasso_10=FNorm(lasso_10.Ez,as.matrix(lasso_10$loadings),Z,M),
Flat_100=FNorm(Flat_100$Ez,Flat_100$M,Z,M),
Normal_100=FNorm(Normal_100$Ez,Normal_100$Mpost,Z,M),
MOM_100=FNorm(MOM_100$Ez,MOM_100$Mpost,Z,M),
#FastBFA_100=FNorm(Laplace_100_Vl20$Omega,Laplace_100_Vl20$B,Z,M),
Lasso_100=FNorm(lasso_100.Ez,as.matrix(lasso_100$loadings),Z,M))
FN.covX=data.frame(Flat_10=FNorm2(Flat_10$sigma,Flat_10$M,Sigma),
Normal_10=FNorm2(Normal_10$sigma,Normal_10$Mpost,Sigma),
MOM_10=FNorm2(MOM_10$sigma,MOM_10$Mpost,Sigma),
#FastBFA_10=FNorm2(Laplace_10_Vl20$sigma,Laplace_10_Vl20$B,Sigma),
Lasso_10=FNorm2(lasso_10$uniquenesses,as.matrix(lasso_10$loadings),Sigma),
Flat_100=FNorm2(Flat_100$sigma,Flat_100$M,Sigma),
Normal_100=FNorm2(Normal_100$sigma,Normal_100$Mpost,Sigma),
MOM_100=FNorm2(MOM_100$sigma,MOM_100$Mpost,Sigma),
#FastBFA_100=FNorm2(Laplace_100_Vl20$sigma,Laplace_100_Vl20$B,Sigma),
Lasso_100=FNorm2(lasso_100$uniquenesses,as.matrix(lasso_100$loadings),Sigma))
it=data.frame(Flat_10=Flat_10$iterations,
Normal_10=Normal_10$iterations,
MOM_10=MOM_10$iterations,
#FastBFA_10=(Laplace_10_Vl5$niter+Laplace_10_Vl10$niter+Laplace_10_Vl10$niter),
Lasso_10=0,
Flat_100=Flat_100$iterations,
Normal_100=Normal_100$iterations,
MOM_100=MOM_100$iterations,
#FastBFA_100=(Laplace_100_Vl5$niter+Laplace_100_Vl10$niter+Laplace_100_Vl10$niter),
Lasso_100=0)
tableFN=rbind.data.frame(q_hat=q.hat.2,Mhat=m.hat.2,FN_ZM2=FN.ZM,FN_covX=FN.covX,it=it)
#####Plost####
##Scaterplots
plot.scat(Z%*%t(M),Flat_100$Ez%*%t(Flat_100$M))
plot.scat(Z%*%t(M),Normal_100$Ez%*%t(Normal_100$Mpost))
plot.scat(Z%*%t(M),MOM_100$Ez%*%t(MOM_100$Mpost))
#plot.scat(Z%*%t(M),resultLaplace_100_Vl20$Omega%*%t(resultLaplace_100_Vl20$B))
plot.scat(Z%*%t(M),lasso_100.Ez%*%t(as.matrix(lasso_100$loadings)))
##Heatmaps
##M
#Flat
plot.heat(Flat_100$M,limit=c(-2,2))
#Normal
plot.heat(Normal_100$Mpost,limit=c(-2,2))
#MOM
plot.heat(MOM_100$Mpost,limit=c(-2,2))
##Covariance
#Flat
plot.heat.cov(Flat_100$M,diag(Flat_100$sigma),limit=c(-3,3))
#Normal
plot.heat.cov(Normal_100$M,diag(Normal_100$sigma),limit=c(-3,3))
#MOM
plot.heat.cov(MOM_100$M,diag(MOM_100$sigma),limit=c(-3,3))
##Gamma
plot.heat(Normal_100$gamma)
plot.heat(MOM_100$gamma)
t(tableFN)
round(t(tableFN),1)
t1.1000.F
####FIX###
####n=100 p=1,000####
####n=100 p=1,000####
t1.1000.F<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Examples/Paper1806/Table1809FixMn100p1000q10NBv2Dataset01")
t1.1000.F
round(t(tableFN),1)
#####Plost####
##Scaterplots
plot.scat(Z%*%t(M),Flat_100$Ez%*%t(Flat_100$M))
#####Plost####
##Scaterplots
plot.scat(Z%*%t(M),Flat_100$Ez%*%t(Flat_100$M))
plot.scat(Z%*%t(M),Normal_100$Ez%*%t(Normal_100$Mpost))
plot.scat(Z%*%t(M),MOM_100$Ez%*%t(MOM_100$Mpost))
#plot.scat(Z%*%t(M),resultLaplace_100_Vl20$Omega%*%t(resultLaplace_100_Vl20$B))
plot.scat(Z%*%t(M),lasso_100.Ez%*%t(as.matrix(lasso_100$loadings)))
##Heatmaps
##M
#Flat
plot.heat(Flat_100$M,limit=c(-2,2))
#Normal
plot.heat(Normal_100$Mpost,limit=c(-2,2))
#MOM
plot.heat(MOM_100$Mpost,limit=c(-2,2))
#Normal
plot.heat(Normal_100$Mpost,limit=c(-2,2))
##Covariance
#Flat
plot.heat.cov(Flat_100$M,diag(Flat_100$sigma),limit=c(-3,3))
#Normal
plot.heat.cov(Normal_100$M,diag(Normal_100$sigma),limit=c(-3,3))
library(BFR.BE)
warnings()
t01.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V3ov01")
t02.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V3ov02")
t03.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V3ov03")
t04.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V3ov04")
t05.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V3ov05")
t06.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V3ov06")
t07.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V3ov07")
t08.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V3ov08")
t09.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V3ov09")
t10.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V3ov10")
CVW01.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808ovCVW01")
CVW02.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808ovCVW02")
CVW03.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808ovCVW03")
CVW04.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808ovCVW04")
CVW05.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808ovCVW05")
CVW06.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808ovCVW06")
CVW07.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808ovCVW07")
CVW08.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808ovCVW08")
CVW09.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808ovCV09")
CVW10.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808ovCVW10")
CVW.ov<-rbind(as.numeric(apply(CVW01.ov[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW02.ov[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW03.ov[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW04.ov[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW05.ov[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW06.ov[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW07.ov[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW08.ov[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW09.ov[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW10.ov[-c(5,6),],2,sort)[1,-1]))
colnames(CVW.ov)<-c(colnames(CVW01.ov)[-1])
CoxTest01.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V2ovCoxTest01")
CoxTest02.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V2ovCoxTest02")
CoxTest03.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V2ovCoxTest03")
CoxTest04.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V2ovCoxTest04")
CoxTest05.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V2ovCoxTest05")
CoxTest06.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V2ovCoxTest06")
CoxTest07.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V2ovCoxTest07")
CoxTest08.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V2ovCoxTest08")
CoxTest09.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V2ovCoxTest09")
CoxTest10.ov<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1808V2ovCoxTest10")
CoxTotalTest.ov<-rbind(CoxTest01.ov,CoxTest02.ov,CoxTest03.ov,CoxTest04.ov,CoxTest05.ov,CoxTest06.ov,CoxTest07.ov,CoxTest08.ov,CoxTest09.ov,CoxTest10.ov)
t01.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808V3lun01")
t02.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808V3lun02")
t03.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808V3lun03")
t04.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808V3lun04")
t05.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808V3lun05")
t06.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808V3lun06")
t07.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808V3lun07")
t08.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808V3lun08")
t09.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808V3lun09")
t10.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808V3lun10")
CVW01.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808lunCVW01")
CVW02.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808lunCVW02")
CVW03.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808lunCVW03")
CVW04.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808lunCVW04")
CVW05.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808lunCVW05")
CVW06.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808lunCVW06")
CVW07.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808lunCVW07")
CVW08.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808lunCVW08")
CVW09.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808lunCVW09")
CVW10.lun<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1808lunCVW10")
CVW.lun<-rbind(as.numeric(apply(CVW01.lun[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW02.lun[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW03.lun[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW04.lun[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW05.lun[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW06.lun[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW07.lun[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW08.lun[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW09.lun[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW10.lun[-c(5,6),],2,sort)[1,-1]))
colnames(CVW.lun)<-c(colnames(CVW01.lun)[-1])
t01.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808V3pan01")
t02.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808V3pan02")
t03.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808V3pan03")
t04.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808V3pan04")
t05.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808V3pan05")
t06.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808V3pan06")
t07.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808V3pan07")
t08.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808V3pan08")
t09.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808V3pan09")
t10.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808V3pan10")
CVW01.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808panCVW01")
CVW02.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808panCVW02")
CVW03.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808panCVW03")
CVW04.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808panCVW04")
CVW05.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808panCVW05")
CVW06.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808panCVW06")
CVW07.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808panCVW07")
CVW08.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808panCVW08")
CVW09.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808panCVW09")
CVW10.pan<-read.csv("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesPan/1808panCVW10")
CVW.pan<-rbind(as.numeric(apply(CVW01.pan[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW02.pan[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW03.pan[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW04.pan[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW05.pan[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW06.pan[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW07.pan[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW08.pan[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW09.pan[-c(5,6),],2,sort)[1,-1]),
as.numeric(apply(CVW10.pan[-c(5,6),],2,sort)[1,-1]))
colnames(CVW.pan)<-c(colnames(CVW01.pan)[-1])
####TableU#####
tablelun=data.frame(q_star=t01.lun[,2],
q_hat=round(apply(cbind(t01.lun[,3],t02.lun[,3],t03.lun[,3],t04.lun[,3],t05.lun[,3],t06.lun[,3],t07.lun[,3],t08.lun[,3],t09.lun[,3],t10.lun[,3]),1,median),1),
m_hat1=round(apply(cbind(t01.lun[,4],t02.lun[,4],t03.lun[,4],t04.lun[,4],t05.lun[,4],t06.lun[,4],t07.lun[,4],t08.lun[,4],t09.lun[,4],t10.lun[,4]),1,mean),1),
m_hat2=round(apply(cbind(t01.lun[,5],t02.lun[,5],t03.lun[,5],t04.lun[,5],t05.lun[,5],t06.lun[,5],t07.lun[,5],t08.lun[,5],t09.lun[,5],t10.lun[,5]),1,mean),1),
Cox_mean=round(apply(cbind(t01.lun[,6],t02.lun[,6],t03.lun[,6],t04.lun[,6],t05.lun[,6],t06.lun[,6],t07.lun[,6],t08.lun[,6],t09.lun[,6],t10.lun[,6]),1,mean),3),
#Cox_median=round(apply(CoxTotalTest.lun,2,median,na.rm=TRUE)[c(2:5,1)],3),
#FN_X=round(apply(cbind(t01.lun[,8],t02.lun[,8],t03.lun[,8],t04.lun[,8],t05.lun[,8],t06.lun[,8],t07.lun[,8],t08.lun[,8],t09.lun[,8],t10.lun[,8]),1,mean),1),
#FN_X_NP=round(apply(cbind(t01.lun[,9],t02.lun[,9],t03.lun[,9],t04.lun[,9],t05.lun[,9],t06.lun[,9],t07.lun[,9],t08.lun[,9],t09.lun[,9],t10.lun[,9]),1,mean),1),
FN_X_test=round(apply(cbind(t01.lun[,10],t02.lun[,10],t03.lun[,10],t04.lun[,10],t05.lun[,10],t06.lun[,10],t07.lun[,10],t08.lun[,10],t09.lun[,10],t10.lun[,10]),1,mean),1),
#FN_X_test_NP=round(apply(cbind(t01.lun[,11],t02.lun[,11],t03.lun[,11],t04.lun[,11],t05.lun[,11],t06.lun[,11],t07.lun[,11],t08.lun[,11],t09.lun[,11],t10.lun[,11]),1,mean),1),
it=round(apply(cbind(t01.lun[,12],t02.lun[,12],t03.lun[,12],t04.lun[,12],t05.lun[,12],t06.lun[,12],t07.lun[,12],t08.lun[,12],t09.lun[,12],t10.lun[,12]),1,mean),3))
tablelun.un=data.frame(q_hat=tablelun$q_hat,
mj_hat=tablelun$m_hat1/tablelun$q_hat,
FN_X_test=tablelun$FN_X_test,
FN_Cov_test=apply(CVW.lun,2,mean))
tablelun.sup=data.frame(q_hat=tablelun$q_hat,
mj_hat=tablelun$m_hat1/tablelun$q_hat,
Cox_mean=tablelun$Cox_mean,
FN_X_test=tablelun$FN_X_test)
tableov=data.frame(q_star=t01.ov[,2],
q_hat=round(apply(cbind(t01.ov[,3],t02.ov[,3],t03.ov[,3],t04.ov[,3],t05.ov[,3],t06.ov[,3],t07.ov[,3],t08.ov[,3],t09.ov[,3],t10.ov[,3]),1,median),1),
m_hat1=round(apply(cbind(t01.ov[,4],t02.ov[,4],t03.ov[,4],t04.ov[,4],t05.ov[,4],t06.ov[,4],t07.ov[,4],t08.ov[,4],t09.ov[,4],t10.ov[,4]),1,mean),1),
m_hat2=round(apply(cbind(t01.ov[,5],t02.ov[,5],t03.ov[,5],t04.ov[,5],t05.ov[,5],t06.ov[,5],t07.ov[,5],t08.ov[,5],t09.ov[,5],t10.ov[,5]),1,mean),1),
Cox_mean=round(apply(cbind(t01.ov[,6],t02.ov[,6],t03.ov[,6],t04.ov[,6],t05.ov[,6],t06.ov[,6],t07.ov[,6],t08.ov[,6],t09.ov[,6],t10.ov[,6]),1,mean),3),
Cox_median=round(apply(CoxTotalTest.ov,2,median,na.rm=TRUE)[c(2:5,1)],3),
#FN_X=round(apply(cbind(t01.ov[,8],t02.ov[,8],t03.ov[,8],t04.ov[,8],t05.ov[,8],t06.ov[,8],t07.ov[,8],t08.ov[,8],t09.ov[,8],t10.ov[,8]),1,mean),1),
#FN_X_NP=round(apply(cbind(t01.ov[,9],t02.ov[,9],t03.ov[,9],t04.ov[,9],t05.ov[,9],t06.ov[,9],t07.ov[,9],t08.ov[,9],t09.ov[,9],t10.ov[,9]),1,mean),1),
FN_X_test=round(apply(cbind(t01.ov[,10],t02.ov[,10],t03.ov[,10],t04.ov[,10],t05.ov[,10],t06.ov[,10],t07.ov[,10],t08.ov[,10],t09.ov[,10],t10.ov[,10]),1,mean),1),
#FN_X_test_NP=round(apply(cbind(t01.ov[,11],t02.ov[,11],t03.ov[,11],t04.ov[,11],t05.ov[,11],t06.ov[,11],t07.ov[,11],t08.ov[,11],t09.ov[,11],t10.ov[,11]),1,mean),1),
it=round(apply(cbind(t01.ov[,12],t02.ov[,12],t03.ov[,12],t04.ov[,12],t05.ov[,12],t06.ov[,12],t07.ov[,12],t08.ov[,12],t09.ov[,12],t10.ov[,12]),1,mean),3))
tableov.un=data.frame(q_hat=tableov$q_hat,
mj_hat=tableov$m_hat1/tableov$q_hat,
FN_X_test=tableov$FN_X_test,
FN_Cov_test=apply(CVW.ov,2,mean))
tableov.sup=data.frame(q_hat=tableov$q_hat,
mj_hat=tableov$m_hat1/tableov$q_hat,
Cox_mean=tableov$Cox_mean,
#Cox_median=tableov$Cox_median,
FN_X_test=tableov$FN_X_test)
table.un=cbind(tableov.un,tablelun.un)
table.sup=cbind(tableov.sup[-3,-4],tablelun.sup[-4,-4])
rownames(table.sup)<-c("Flat","Normal-SS","MOM-SS","ComBat")
xtable(table.un[-4,],digits=c(0,rep(1,8)))
xtable(table.sup,digits=c(0,rep(c(1,1,3),2)))
#######NEW ComBat Flat#####
####Unsupervised###
#COMBAT
TablesComBat.ov=do.call("rbind",llply(.data = 1:10, .fun = function(k){
if(k<10){
read.csv(sprintf("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1810tableComBat0%g",k))[,-1]
}else{
read.csv(sprintf("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1810tableComBat%g",k))[,-1]
}
}, .parallel = FALSE))
TablesComBat.ov.v2=do.call("rbind",llply(.data = 1:10, .fun = function(k){
if(k<10){
read.csv(sprintf("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1810v2tableComBat0%g",k))[,-1]
}else{
read.csv(sprintf("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1810v2tableComBat%g",k))[,-1]
}
}, .parallel = FALSE))
TablesFlat.ov=do.call("rbind",llply(.data = 1:10, .fun = function(k){
read.csv(sprintf("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1810tableFlat%g",k))[,-1]
}, .parallel = FALSE))
TablesMOM2.ov=do.call("rbind",llply(.data = 1:10, .fun = function(k){
read.csv(sprintf("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesOV/1810tableMOM2%g",k))[,-1]
}, .parallel = FALSE))
#TABLE OV
tableov.un.2<-data.frame(q_hat=tableov$q_hat,
mj_hat=tableov$m_hat2,
FN_X_test=tableov$FN_X_test,
FN_Cov_test=apply(CVW.ov,2,mean))
tableov.un.2<-rbind(apply(TablesFlat.ov,2,mean)[-3],tableov.un.2[c(2,3),],apply(TablesComBat.ov,2,mean)[-3],apply(TablesComBat.ov.v2,2,mean)[-3])
rownames(tableov.un.2)<-c("Flat","Normal-SS","MOM-SS","ComBat-MLE 90%","ComBat-MLE 75%")
tableov.un.2
#COMBAT
TablesComBat.lun=do.call("rbind",llply(.data = 1:10, .fun = function(k){
read.csv(sprintf("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1810tableComBat%g",k))[,-1]
}, .parallel = FALSE))
TablesComBat.lun.v2=do.call("rbind",llply(.data = 1:10, .fun = function(k){
read.csv(sprintf("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1810v2tableComBat0%g",k))[,-1]
}, .parallel = FALSE))
TablesFlat.lun=do.call("rbind",llply(.data = 1:10, .fun = function(k){
read.csv(sprintf("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1810tableFlat%g",k))[,-1]
}, .parallel = FALSE))
CoxComBat.lun=do.call("cbind",llply(.data = 1:10, .fun = function(k){
read.csv(sprintf("/Users/alejandraavalospacheco/Dropbox/OxWaSP/Programing/BFA/Cancer_datasets/TablesLUN/1810CoxComBat%g",k))[,2]
}, .parallel = FALSE))
#LUN
tablelun.un.2<-data.frame(q_hat=tablelun$q_hat,
mj_hat=tablelun$m_hat2,
FN_X_test=tablelun$FN_X_test,
FN_Cov_test=apply(CVW.lun,2,mean))
tablelun.un.2<-tablelun.un.2[-c(1,4,5),]
tablelun.un.2<-rbind(apply(TablesFlat.lun,2,mean)[-3],tablelun.un.2,apply(TablesComBat.lun,2,mean)[-3],apply(TablesComBat.lun.v2,2,mean)[-3])
rownames(tablelun.un.2)<-c("Flat","Normal-SS","MOM-SS","ComBat-MLE 90%","ComBat-MLE 75%")
tablelun.un.2
####Supervised###
#OV
tableov.sup.2<-data.frame(q_hat=tableov$q_hat,
mj_hat=tableov$m_hat2,
Cox_mean=tableov$Cox_mean)
tableov.sup.2<-rbind(apply(TablesFlat.ov,2,mean)[-c(4:5)],tableov.sup.2[2,],apply(TablesMOM2.ov,2,mean)[-c(4:5)],apply(TablesComBat.ov,2,mean)[-c(4:5)],apply(TablesComBat.ov.v2,2,mean)[-c(4:5)])
rownames(tableov.sup.2)<-c("Flat","Normal-SS","MOM-SS","ComBat-MLE 90%","ComBat-MLE 70%")
tableov.sup.2
tablelun.sup.2<-data.frame(q_hat=tablelun$q_hat,
mj_hat=tablelun$m_hat2,
Cox_mean=tablelun$Cox_mean)
tablelun.sup.2<-tablelun.sup.2[-c(1,4,5),]
tablelun.sup.2<-rbind(apply(TablesFlat.lun,2,mean)[-c(4:5)],tablelun.sup.2,apply(TablesComBat.lun,2,mean)[-c(4:5)],apply(TablesComBat.lun.v2,2,mean)[-c(4:5)])
rownames(tablelun.sup.2)<-c("Flat","Normal-SS","MOM-SS","ComBat-MLE 90%","ComBat-MLE 75%")
tablelun.sup.2
cbind(tableov.sup.2,tablelun.sup.2)
library(BFR.BE) #My code
